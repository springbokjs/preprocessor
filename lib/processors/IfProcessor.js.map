{"version":3,"sources":["../../src/processors/IfProcessor.js"],"names":[],"mappings":"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","file":"IfProcessor.js","sourcesContent":["import AbstractProcessor from './AbstractProcessor';\n\nexport default class IfProcessor extends AbstractProcessor {\n    constructor() {\n        super(...arguments);\n        this.stack = [];\n        this.throwAway = false;\n    }\n\n    async process({ source, instruction, content }) {\n        const pop = () => {\n            source.expectingEOF--;\n            const value = this.stack.pop();\n\n            if (this.stack.length === 0) {\n                this.throwAway = false;\n            } else {\n                this.throwAway = this.stack.some(value => !value.includes || value.throwAway);\n            }\n\n            return value;\n        };\n\n        let includes;\n        let throwAway = false;\n        if (instruction === 'elseif' || instruction === 'elseifdef') {\n            instruction = instruction === 'elseif' ? 'if' : 'ifdef';\n            const value = pop();\n            throwAway = value.includes || value.throwAway;\n        }\n\n        if (instruction === 'ifdef') {\n            includes = this.hasDefined(content);\n        } else if (instruction === 'ifnotdef') {\n            includes = !this.hasDefined(content);\n        } else if (instruction === 'if') {\n            includes = !!this.getDefined(content);\n        } else if (instruction === 'ifnot') {\n            includes = !this.getDefined(content);\n        } else if (instruction === 'else') {\n            const previous = pop();\n            includes = !previous.includes && !previous.throwAway;\n            instruction = 'if';\n        }\n\n        if (['ifdef', 'ifnotdef', 'if', 'ifnot'].indexOf(instruction) !== -1) {\n            source.expectingEOF++;\n            if (throwAway) {\n                this.throwAway = true;\n            } else if (!this.throwAway && !includes) {\n                this.throwAway = !includes;\n            }\n\n            this.stack.push({ includes, throwAway });\n        } else {\n            pop();\n        }\n\n        return {\n            replaceBy: '',\n            throwAway: this.throwAway,\n        };\n    }\n}\n"]}